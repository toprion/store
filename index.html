<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar Kategori dan Brand</title>
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #1a1a2e;
      color: #fff;
    }
    .container-product {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 20px;
    }
    .card {
      background-color: #333;
      border-radius: 10px;
      margin: 10px;
      width: 100px;
      overflow: hidden;
      position: relative;
      text-align: center;
      cursor: pointer;
    }
    .card img {
      width: 100%;
      height: 100px; /* Ukuran gambar yang seragam */
      object-fit: cover; /* Menjaga proporsi gambar */
    }
    .card .content {
      padding: 10px;
    }
    .card .title {
      font-size: 16px;
      font-weight: bold;
      margin: 5px 0;
    }
    
    
    
        .container {
            width: 90%;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }
        .header img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }
        .header .icons {
            display: flex;
            align-items: center;
        }
        .header .icons i {
            font-size: 1.5em;
            margin-left: 20px;
        }
        .banner {
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        .banner img {
            width: 100%;
            border-radius: 10px;
        }
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .section-title i {
            color: #ff4500;
            margin-right: 10px;
        }
        .section-title h2 {
            font-size: 1.5em;
            margin: 0;
        }
        .product-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .product-item {
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 10px;
            flex: 1 1 calc(50% - 10px);
            display: flex;
            align-items: center;
        }
        .product-item img {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            margin-right: 10px;
        }
        .product-item .product-info {
            flex-grow: 1;
        }
        .product-item .product-info h3 {
            margin: 0;
            font-size: 1em;
        }
        .product-item .product-info p {
            margin: 0;
            font-size: 0.8em;
            color: #aaa;
        }
    
    
    .tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
    }
    .tabs button {
            background-color: #1e1e1e;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            margin-left: 10px;
   }
    .tabs button.active {
            background-color: #007bff;
   }
   .footer {
            background-color: #1e1e1e;
            padding: 20px 0;
            text-align: center;
        }
        .footer .social-icons {
            margin-bottom: 20px;
        }
        .footer .social-icons i {
            font-size: 1.5em;
            margin: 0 10px;
        }
        .footer .links {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            border-bottom: 0.1px solid #373746;
        }
        .footer .links div {
            margin: 10px 0;
        }
        .footer .links a {
            color: #fff;
            text-decoration: none;
            display: block;
            margin: 5px 0;
        }
        .footer .copyright {
            margin-top: 20px;
            font-size: 0.8em;
            color: #aaa;
        }
  </style>
</head>
<body>
  <div class="container">
   <header class="header">
    <img alt="User avatar" height="50" src="kyyragoods.jpeg" width="50"/>
    <div class="icons">
     <i class="fas fa-search">
     </i>
     <i class="fas fa-flag">
     </i>
     <i class="fas fa-user">
     </i>
    </div>
   </header>
   <div class="banner">
    <img alt="Banner image with gaming characters" height="200" src="https://storage.googleapis.com/a1aa/image/qlep9PVyv0w4U6VrGcp268hOMwoSOYHcHK7ZAne2g633VK8TA.jpg" width="800"/>
   </div>
   <div class="section-title">
    <i class="fas fa-fire">
    </i>
    <h2>
     POPULER SEKARANG!
    </h2>
   </div>
   <div class="product-list">
    <div class="product-item">
     <img alt="Blood Strike game cover" height="50" src="https://storage.googleapis.com/a1aa/image/g6g0cdLe7PxhSqYOK1LA2Bn1GimKEjGR15XNeylZ4My8VK8TA.jpg" width="50"/>
     <div class="product-info">
      <h3>
       Blood Strike
      </h3>
      <p>
       Wizard Games Global Limited
      </p>
     </div>
    </div>
    <div class="product-item">
     <img alt="Mobile Legends game cover" height="50" src="https://storage.googleapis.com/a1aa/image/YyFYIleiC50XHKL95oKsGjz1jZYKQwXzViCRLWNaMQO9KFeTA.jpg" width="50"/>
     <div class="product-info">
      <h3>
       Mobile Legends
      </h3>
      <p>
       Moonton
      </p>
     </div>
    </div>
    <div class="product-item">
     <img alt="Free Fire MAX game cover" height="50" src="https://storage.googleapis.com/a1aa/image/AJxdonRD9KKaChJPnxfuUQTTISeJLktm9E3PwCib8ZrHWK8TA.jpg" width="50"/>
     <div class="product-info">
      <h3>
       Free Fire MAX
      </h3>
      <p>
       Garena
      </p>
     </div>
    </div>
    <div class="product-item">
     <img alt="Free Fire game cover" height="50" src="https://storage.googleapis.com/a1aa/image/JSVCgHXKiEaBNhJJSMM2GkZuhVdADJpi80JYm1xbrrUfKFeTA.jpg" width="50"/>
     <div class="product-info">
      <h3>
       Free Fire
      </h3>
      <p>
       Garena
      </p>
     </div>
    </div>
    <div class="product-item">
     <img alt="Mobile Legends game cover" height="50" src="https://storage.googleapis.com/a1aa/image/YyFYIleiC50XHKL95oKsGjz1jZYKQwXzViCRLWNaMQO9KFeTA.jpg" width="50"/>
     <div class="product-info">
      <h3>
       Mobile Legends
      </h3>
      <p>
       Moonton
      </p>
     </div>
    </div>
    <div class="product-item">
     <img alt="PUBG Mobile game cover" height="50" src="https://storage.googleapis.com/a1aa/image/iLPywIIjcr6cIx7YLJwFtDthyH5WB0rYHTrNlVqQCiMeKFeTA.jpg" width="50"/>
     <div class="product-info">
      <h3>
       PUBG Mobile
      </h3>
      <p>
       Tencent Games
      </p>
     </div>
    </div>
   </div>
  </div>
  <div class="tabs">
  <div id="categoryList" class="category-list"></div>
  </div>
  <div id="brandList" class="container-product"></div>
  <div id="brandDetails" class="brand-details"></div>
  
  
    <footer class="footer">
    <div class="social-icons">
     <i class="fab fa-instagram">
     </i>
     <i class="fab fa-youtube">
     </i>
     <i class="fab fa-whatsapp">
     </i>
     <i class="fab fa-facebook">
     </i>
    </div>
    <div class="links">
     <div>
      <h3>
       Peta Situs
      </h3>
      <a href="#">
       Beranda
      </a>
      <a href="#">
       Hubungi Kami
      </a>
     </div>
     <div>
      <h3>
       Dukungan
      </h3>
      <a href="#">
       WhatsApp
      </a>
      <a href="#">
       Email
      </a>
      <a href="#">
       Telegram
      </a>
      <a href="#">
       Instagram
      </a>
      <a href="#">
       Facebook
      </a>
     </div>
     
    </div>
    <div class="links">
    <div>
      <h3>
       Informasi
      </h3>
      <a href="#">
       Kebijakan Privasi
      </a>
      <a href="#">
       Syarat &amp; Ketentuan
      </a>
     </div>
    </div>
    <div class="copyright">
     Â© 2024 KYYRAGOODS. All rights reserved.
    </div>
   </footer>
  
  
  <script>
    let brandData = [];
    let currentCategory = "Games";
    let selectedProduct = null;
    let refId = ''; // Variabel untuk menyimpan ref_id

    const BASE_URL = "https://server.goppob.my.id"; // URL Vercel untuk pengujian sementara, ganti dengan URL final

    async function fetchBrands() {
      try {
        const response = await fetch(`${BASE_URL}/price-list`);
        if (!response.ok) throw new Error("Gagal mengambil data dari API");

        brandData = await response.json();
        const categories = [...new Set(brandData.map(item => item.category))];
        displayCategories(categories);
        displayBrands(currentCategory);
      } catch (error) {
        console.error("Error fetching brands:", error);
      }
    }

    function displayCategories(categories) {
      const categoryList = document.getElementById("categoryList");
      categoryList.innerHTML = "";
      categories.forEach(category => {
        const categoryButton = document.createElement("button");
        categoryButton.className = "category-button";
        categoryButton.textContent = category;
        categoryButton.onclick = () => {
          currentCategory = category;
          displayBrands(category);
        };
        categoryList.appendChild(categoryButton);
      });
      categoryList.style.display = "block";
    }

    function displayBrands(category) {
      const brandList = document.getElementById("brandList");
      const brandDetails = document.getElementById("brandDetails");
      const categoryList = document.getElementById("categoryList");

      brandList.innerHTML = "";
      brandDetails.style.display = "none";
      categoryList.style.display = "block";

      const filteredBrands = brandData.filter(item => item.category === category);
      const displayedBrands = new Set();

      filteredBrands.forEach(item => {
        if (displayedBrands.has(item.brand)) return;
        displayedBrands.add(item.brand);

        const brandItem = document.createElement("div");
        brandItem.className = "card";
        const brandHash = item.brand.replace(/\s+/g, "-");

        brandItem.innerHTML = `
          <img src="kyyragoods.jpeg" alt="${item.brand}">
          <div class="content">
            <div class="title">${item.brand}</div>
          </div>
        `;
        brandItem.onclick = () => handleBrandClick(item.brand);
        brandList.appendChild(brandItem);
      });

      brandList.style.display = "flex";
    }

    function handleBrandClick(brand) {
      window.location.hash = brand.replace(/\s+/g, "-");
    }

    function displayBrandDetails(brand) {
      const brandDetails = document.getElementById("brandDetails");
      const categoryList = document.getElementById("categoryList");
      const brandList = document.getElementById("brandList");

      categoryList.style.display = "none";
      brandList.style.display = "none";

      const products = brandData.filter(item => item.category === currentCategory && item.brand === brand);

      brandDetails.innerHTML = `
        <div class="form-container">
          <label for="customerNo">Masukkan Nomor Pelanggan:</label>
          <input type="text" id="customerNo" placeholder="Nomor Pelanggan">
          <div id="error" class="error"></div>
        </div>
        ${products
          .map(item => `
            <div class="product-item">
              <button class="product-button" onclick="selectProduct(this, '${item.buyer_sku_code}', '${item.product_name}', '${item.kyyraprice}')">
                ${item.product_name} - Rp${parseInt(item.kyyraprice).toLocaleString("id-ID")}
              </button>
            </div>
          `)
          .join("")}
        <button class="submit-button" onclick="submitTransaction()">Submit</button>
      `;

      brandDetails.style.display = "block";
    }

    function selectProduct(button, sku, productName, price) {
      document.querySelectorAll(".product-button").forEach(btn => btn.classList.remove("selected"));
      button.classList.add("selected");
      selectedProduct = { sku, productName, price };
    }

    async function submitTransaction() {
      const customerNo = document.getElementById("customerNo").value;
      const error = document.getElementById("error");

      if (!customerNo) {
        error.textContent = "Silahkan isi data akun dahulu";
        document.getElementById("customerNo").focus();
        return;
      }

      if (!selectedProduct) {
        alert("Harap pilih produk terlebih dahulu!");
        return;
      }

      error.textContent = "";
      const requestData = {
        buyer_sku_code: selectedProduct.sku,
        customer_no: customerNo,
      };

      try {
        const response = await fetch(`${BASE_URL}/admin`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(requestData),
        });

        if (!response.ok) throw new Error("Gagal mengirim data ke server");

        const transactionResponse = await response.json();
        console.log(transactionResponse);
        refId = transactionResponse.ref_id; // Menyimpan ref_id

        // Menyimpan respons transaksi ke localStorage
        localStorage.setItem("transactionResponse", JSON.stringify(transactionResponse));

      } catch (error) {
        alert("Terjadi kesalahan: " + error.message);
      }
    }

    function handleHashChange() {
      const brand = window.location.hash.slice(1).replace(/-/g, " ");
      const categoryList = document.getElementById("categoryList");

      if (!brand) {
        categoryList.style.display = "block";
        displayBrands(currentCategory);
        return;
      }
      displayBrandDetails(brand);
    }

    window.onload = () => {
      fetchBrands();
      window.addEventListener("hashchange", handleHashChange);
    };
  </script>
</body>
</html>
